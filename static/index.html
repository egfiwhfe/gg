<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PolyMix - Â§öÂπ≥Âè∞ËµîÁéáÂØπÊØî</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
        }

        /* Header */
        .header {
            background: rgba(20, 20, 30, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px 40px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .logo-title {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo {
            height: 50px;
            width: auto;
        }

        h1 {
            font-size: 36px;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .social-links {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .social-link {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 25px;
            text-decoration: none;
            color: #e0e0e0;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .social-link:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(102, 126, 234, 0.5);
            transform: translateY(-2px);
        }

        .social-icon {
            width: 20px;
            height: 20px;
        }

        .platform-badges {
            display: flex;
            gap: 10px;
        }

        .platform-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            border: 2px solid;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .platform-badge.active {
            background: rgba(255, 255, 255, 0.1);
        }

        .badge-polymarket { border-color: #6366f1; color: #6366f1; }
        .badge-kalshi { border-color: #10b981; color: #10b981; }
        .badge-odds { border-color: #f59e0b; color: #f59e0b; }
        .badge-manifold { border-color: #8b5cf6; color: #8b5cf6; }

        /* Game Card - New Design */
        .game-card {
            background: rgba(20, 20, 30, 0.6);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .game-card:hover {
            border-color: rgba(102, 126, 234, 0.5);
            transform: translateY(-2px);
            box-shadow: 0 8px 32px rgba(102, 126, 234, 0.2);
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .matchup {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 22px;
            font-weight: 700;
            color: #fff;
        }

        .team-name {
            color: #667eea;
        }

        .vs {
            color: #555;
            font-size: 16px;
        }

        .game-meta {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .arb-score {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 10px 18px;
            border-radius: 25px;
            font-size: 15px;
            font-weight: 700;
        }

        .arb-score.high {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        }

        .sport-chip {
            padding: 4px 12px;
            border-radius: 999px;
            font-size: 11px;
            font-weight: 600;
            letter-spacing: 1px;
            text-transform: uppercase;
            background: rgba(255, 255, 255, 0.08);
        }

        .sport-chip.nba { color: #f97316; }
        .sport-chip.nfl { color: #10b981; }
        .sport-chip.nhl { color: #38bdf8; }

        /* Multi-Platform Comparison Table */
        .comparison-table {
            display: table;
            width: 100%;
            border-spacing: 0 10px;
        }

        .comparison-row {
            display: table-row;
        }

        .comparison-cell {
            display: table-cell;
            padding: 15px;
            background: rgba(255, 255, 255, 0.02);
            vertical-align: middle;
        }

        .comparison-cell:first-child {
            border-radius: 12px 0 0 12px;
            font-weight: 600;
            color: #aaa;
            width: 180px;
        }

        .team-cell {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .team-logo-cell {
            width: 32px;
            height: 32px;
            object-fit: contain;
        }

        .comparison-cell:last-child {
            border-radius: 0 12px 12px 0;
        }

        .platform-cell {
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .platform-cell:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: scale(1.02);
        }

        .platform-name {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .platform-polymarket .platform-name { color: #6366f1; }
        .platform-kalshi .platform-name { color: #10b981; }
        .platform-odds .platform-name { color: #f59e0b; }
        .platform-manifold .platform-name { color: #8b5cf6; }

        .odds-value {
            font-size: 28px;
            font-weight: 700;
            color: #fff;
        }

        .diff-badge {
            display: inline-block;
            margin-top: 5px;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .diff-badge.high {
            background: rgba(244, 67, 54, 0.2);
            color: #f44336;
        }

        .diff-badge.medium {
            background: rgba(255, 152, 0, 0.2);
            color: #ff9800;
        }

        .diff-badge.low {
            background: rgba(76, 175, 80, 0.2);
            color: #4caf50;
        }

        .unavailable {
            opacity: 0.3;
            font-size: 14px;
            color: #666;
        }

        /* Highlight Best Odds */
        .best-odds {
            position: relative;
        }

        .best-odds::after {
            content: '‚òÖ';
            position: absolute;
            top: -5px;
            right: -5px;
            font-size: 16px;
            color: #ffd700;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 60px 20px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-label {
            font-size: 11px;
            color: #888;
            text-transform: uppercase;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: #fff;
        }

        /* Mobile Responsive Design */
        @media (max-width: 1024px) {
            body {
                padding: 10px;
            }

            .header {
                padding: 20px;
            }

            h1 {
                font-size: 24px;
            }

            .logo {
                height: 40px;
            }

            .platform-badges {
                flex-wrap: wrap;
            }

            .platform-badge {
                font-size: 11px;
                padding: 6px 12px;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .comparison-table {
                display: block;
            }

            .comparison-row {
                display: block;
                margin-bottom: 15px;
            }

            .comparison-cell {
                display: block;
                width: 100% !important;
                border-radius: 12px !important;
                margin-bottom: 8px;
            }

            .comparison-cell:first-child {
                background: rgba(102, 126, 234, 0.2);
                font-size: 16px;
                padding: 12px;
            }

            .odds-value {
                font-size: 24px;
            }

            .game-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .matchup {
                font-size: 18px;
            }
        }

        @media (max-width: 640px) {
            .header-top {
                flex-direction: column;
                align-items: flex-start;
            }

            .logo-title {
                width: 100%;
            }

            .social-links {
                width: 100%;
                justify-content: space-between;
            }

            .social-link {
                flex: 1;
                justify-content: center;
                padding: 8px 12px;
                font-size: 12px;
            }

            .social-link span {
                display: none;
            }

            h1 {
                font-size: 20px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .stat-value {
                font-size: 20px;
            }

            .arb-score {
                font-size: 13px;
                padding: 8px 14px;
            }

            .team-logo-cell {
                width: 24px;
                height: 24px;
            }
        }
    
        /* Sport tabs for multi-market (NBA / NFL) */
        .sport-tabs {
            margin-top: 16px;
            display: inline-flex;
            padding: 4px;
            border-radius: 999px;
            background: rgba(255, 255, 255, 0.04);
            gap: 4px;
        }

        .sport-tab {
            border: none;
            outline: none;
            padding: 6px 18px;
            border-radius: 999px;
            font-size: 13px;
            cursor: pointer;
            background: transparent;
            color: rgba(255, 255, 255, 0.6);
            transition: all 0.15s ease;
        }

        .sport-tab.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: #ffffff;
            box-shadow: 0 4px 14px rgba(102, 126, 234, 0.4);
        }

        .sport-tab:not(.active):hover {
            background: rgba(255, 255, 255, 0.06);
            color: rgba(255, 255, 255, 0.9);
        }
</style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-top">
                <div class="logo-title">
                    <img src="/static/logoduolai.png" alt="PolyMix Logo" class="logo">
                    <h1>Â§öÂπ≥Âè∞ËµîÁéáÂØπÊØî</h1>
                </div>
                <div class="social-links">
                    <a href="/paper" class="social-link" style="background: rgba(16, 185, 129, 0.1); color: #10b981; border-color: rgba(16, 185, 129, 0.3);">
                        <svg class="social-icon" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
                        </svg>
                        <span>Paper Trading</span>
                    </a>
                    <a href="https://t.me/dsa885" target="_blank" class="social-link">
                        <svg class="social-icon" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm5.562 8.161c-.18 1.897-.962 6.502-1.359 8.627-.168.9-.5 1.201-.82 1.23-.697.064-1.226-.461-1.901-.903-1.056-.692-1.653-1.123-2.678-1.799-1.185-.781-.417-1.21.258-1.911.177-.184 3.247-2.977 3.307-3.23.007-.032.015-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.139-5.062 3.345-.479.329-.913.489-1.302.481-.428-.009-1.252-.242-1.865-.442-.751-.244-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.831-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635.099-.002.321.023.465.141.121.099.155.232.171.326.016.094.037.308.021.475z"/>
                        </svg>
                        <span>Telegram</span>
                    </a>
                    <a href="https://x.com/hunterweb303" target="_blank" class="social-link">
                        <svg class="social-icon" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                        </svg>
                        <span>Twitter</span>
                    </a>
                </div>
            </div>
            <div class="platform-badges">
                    <div class="platform-badge badge-polymarket active">
                        <span>‚óè</span> Polymarket
                    </div>
                    <div class="platform-badge badge-kalshi active">
                        <span>‚óè</span> Kalshi
                    </div>
                    <div class="platform-badge badge-odds">
                        <span>‚óã</span> Sportsbooks
                    </div>
                    <div class="platform-badge badge-manifold">
                        <span>‚óã</span> Manifold
                    
                </div>
            </div>

            <div class="sport-tabs">
                <button class="sport-tab active" data-sport="multi">üî• ÁªºÂêà</button>
                <button class="sport-tab" data-sport="nba">NBA</button>
                <button class="sport-tab" data-sport="nfl">NFL</button>
                <button class="sport-tab" data-sport="nhl">NHL</button>
            </div>

            <div class="betting-controls" style="margin-top: 20px; background: rgba(255, 255, 255, 0.05); padding: 15px; border-radius: 12px; display: flex; align-items: center; gap: 15px;">
                <label style="font-weight: 600; color: #ccc;">üí∞ ‰∏ãÊ≥®ÊàêÊú¨ (Total Investment): $</label>
                <input type="number" id="investment-input" value="1000" style="background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(255, 255, 255, 0.2); padding: 8px 12px; border-radius: 6px; color: #fff; width: 120px; font-weight: bold;">
                <span style="font-size: 12px; color: #888;">* ‰ªÖÊòæÁ§∫ÂáÄÊî∂Áõä > 0% ÁöÑÊú∫‰ºö</span>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Polymarket Â∏ÇÂú∫</div>
                    <div class="stat-value" id="poly-count">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Kalshi Â∏ÇÂú∫</div>
                    <div class="stat-value" id="kalshi-count">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">ÂåπÈÖçÂ∏ÇÂú∫</div>
                    <div class="stat-value" id="matched-count">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Â•óÂà©Êú∫‰ºö</div>
                    <div class="stat-value" id="arb-count" style="color: #4caf50;">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">ÊòæÁ§∫Â∏ÇÂú∫</div>
                    <div class="stat-value" id="displayed-count" style="color: #667eea;">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">ÊúÄÂ§ßÂ∑ÆÂºÇ</div>
                    <div class="stat-value" id="max-diff">-</div>
                </div>
            </div>
        </div>

        <!-- Games List -->
        <div id="games-container">
            <div class="loading">
                <div class="spinner"></div>
                <div>Âä†ËΩΩÊØîËµõÊï∞ÊçÆ‰∏≠...</div>
            </div>
        </div>
    </div>

    <script>
        function getDiffClass(diff) {
            if (diff >= 5) return 'high';
            if (diff >= 2) return 'medium';
            return 'low';
        }

        // Ë¥πÁî®ÂÅáËÆæÔºà‰∏éÂêéÁ´Ø ArbitrageDetector ‰øùÊåÅ‰∏ÄËá¥Ôºâ
        const POLY_FEE = 0.02;   // Polymarket ~2%
        const KALSHI_FEE = 0.07; // Kalshi ~7%
        const SLIPPAGE_ESTIMATE = 0.005; // È¢ùÂ§ñ 0.5% ÊªëÁÇπÂÆπÂøç

        function extractPrice(source, key) {
            if (!source) return null;
            const rawKey = key === 'away' ? 'raw_away' : 'raw_home';
            const candidates = [rawKey, key];
            for (const candidate of candidates) {
                const value = source[candidate];
                if (value === undefined || value === null || value === '') continue;
                const parsed = typeof value === 'number' ? value : parseFloat(value);
                if (Number.isFinite(parsed)) {
                    return parsed;
                }
            }
            return null;
        }

        function formatPrice(value) {
            if (!Number.isFinite(value)) return '-';
            const rounded = Math.round(value * 100) / 100;
            return Number.isInteger(rounded) ? rounded.toString() : rounded.toFixed(2);
        }

        // ËÆ°ÁÆó‰∏ÄÂú∫ÊØîËµõÂú®Êâ£Èô§ÂèåËæπÊâãÁª≠Ë¥πÂêéÁöÑÊó†È£éÈô©Â•óÂà©ÊÉÖÂÜµ

        //       Â¶ÇÊûú‰∏§ËæπÂêàËÆ°ÊàêÊú¨ < 100ÔºåÂàôÂ≠òÂú®Êó†È£éÈô©Â•óÂà©Ôºåedge ‰∏∫ÂáÄÊî∂ÁõäÁôæÂàÜÊØî
        
        // ËøáÊª§ÊûÅÁ´ØÂ∏ÇÂú∫Ôºö‰ªªÊÑèÁõòÂè£Âá∫Áé∞ 0% Êàñ 100% Êó∂Áõ¥Êé•ÈöêËóèÔºàÈÄöÂ∏∏ÊòØÊï∞ÊçÆÂºÇÂ∏∏ÊàñÂ∑≤ÁªìÁÆóÔºâ
        function isDegenerateMarket(game) {
            try {
                const vals = [
                    extractPrice(game.polymarket || {}, 'away'),
                    extractPrice(game.polymarket || {}, 'home'),
                    extractPrice((game.kalshi || {}), 'away'),
                    extractPrice((game.kalshi || {}), 'home'),
                ].filter(v => v !== null && v !== undefined);
                if (!vals.length) return true;
                return vals.some(v => v === 0 || v === 100);
            } catch (e) {
                return true;
            }
        }


function calcRiskFreeArb(game) {
            const poly = game.polymarket || {};
            const kalshi = game.kalshi || {};

            const polyAway = extractPrice(poly, 'away');
            const polyHome = extractPrice(poly, 'home');
            const kalshiAway = extractPrice(kalshi, 'away');
            const kalshiHome = extractPrice(kalshi, 'home');

            // ‰ªªÊÑè‰∏ÄËæπÁº∫Â§±‰ª∑Ê†ºÂàôÊó†Ê≥ïÂà§Êñ≠ËøôÁßçÂ•óÂà©
            if (
                polyAway == null || polyHome == null ||
                kalshiAway == null || kalshiHome == null
            ) {
                return null;
            }

            function pickBestSide(polyPrice, kalshiPrice) {
                const polyEffective = polyPrice * (1 + POLY_FEE + SLIPPAGE_ESTIMATE);
                const kalshiEffective = kalshiPrice * (1 + KALSHI_FEE + SLIPPAGE_ESTIMATE);

                if (polyEffective <= kalshiEffective) {
                    return {
                        platform: 'Polymarket',
                        price: polyPrice,
                        effectivePrice: polyEffective
                    };
                }

                return {
                    platform: 'Kalshi',
                    price: kalshiPrice,
                    effectivePrice: kalshiEffective
                };
            }

            const away = pickBestSide(polyAway, kalshiAway);
            const home = pickBestSide(polyHome, kalshiHome);

            // CRITICAL VALIDATION: Prevent same-platform bets
            if (away.platform === home.platform) {
                return null;
            }

            const grossCost = away.price + home.price;               // Êú™Êâ£ÊâãÁª≠Ë¥πÊàêÊú¨Ôºà‰æãÂ¶Ç 96Ôºâ
            const grossEdge = 100 - grossCost;                        // Êú™Êâ£ÊâãÁª≠Ë¥πÁêÜËÆ∫ÊØõÂà©

            const totalEffectiveCost = away.effectivePrice + home.effectivePrice; // Âê´ÊâãÁª≠Ë¥πÊàêÊú¨
            if (totalEffectiveCost <= 0) return null;
            const netEdge = 100 - totalEffectiveCost;                 // Âê´ÊâãÁª≠Ë¥πÂáÄÊî∂Áõä

            // ROI Check: Require Net Yield > 0%
            const roi = netEdge / totalEffectiveCost;
            if (roi <= 0) {
                return null;
            }

            return {
                bestAwayPrice: away.price,
                bestHomePrice: home.price,
                bestAwayEffective: away.effectivePrice,
                bestHomeEffective: home.effectivePrice,
                bestAwayFrom: away.platform,
                bestHomeFrom: home.platform,
                totalCost: totalEffectiveCost,
                edge: netEdge,
                roi,
                grossCost,
                grossEdge
            };
        }


function createGameCard(game) {
            if (isDegenerateMarket(game)) { return ''; }
            const arb = calcRiskFreeArb(game);
            if (!arb) {
                return '';
            }

            const sportTag = game.sport ? `<span class="sport-chip ${game.sport.toLowerCase()}">${game.sport}</span>` : '';

            // Calculate differences from Polymarket
            const polyAway = game.polymarket.away;
            const polyHome = game.polymarket.home;
            const kalshiAway = game.kalshi ? game.kalshi.away : 0;
            const kalshiHome = game.kalshi ? game.kalshi.home : 0;

            const kalshiDiffAway = game.kalshi ? Math.abs(polyAway - kalshiAway) : 0;
            const kalshiDiffHome = game.kalshi ? Math.abs(polyHome - kalshiHome) : 0;

            // Determine best odds for each team
            const awayBest = game.kalshi && (polyAway > kalshiAway) ? 'poly' : 'kalshi';
            const homeBest = game.kalshi && (polyHome > kalshiHome) ? 'poly' : 'kalshi';

            // Investment Calculation
            const investInput = document.getElementById('investment-input');
            const totalInvestment = investInput ? (parseFloat(investInput.value) || 1000) : 1000;

            // Êï∞ÂÄº‰øùÊä§ÔºöÈÅøÂÖç 0 Êàñ NaN ÂØºËá¥ NaN/Infinity
            const bestAwayEff = Math.max(0.0001, Number(arb.bestAwayEffective));
            const bestHomeEff = Math.max(0.0001, Number(arb.bestHomeEffective));
            const totalCostEff = Math.max(0.0001, Number(arb.totalCost));

            if (![bestAwayEff, bestHomeEff, totalCostEff].every(Number.isFinite)) {
                return '';
            }

            // Allocate investment proportional to effective cost to ensure equal payout
            const investAway = (bestAwayEff / totalCostEff) * totalInvestment;
            const investHome = (bestHomeEff / totalCostEff) * totalInvestment;

            // Expected Payout
            const payoutAway = investAway / (arb.bestAwayEffective / 100);
            const payoutHome = investHome / (arb.bestHomeEffective / 100);
            
            const expectedPayout = (payoutAway + payoutHome) / 2;
            const netProfit = expectedPayout - totalInvestment;
            let roiPercent = (netProfit / totalInvestment) * 100;
            if (!Number.isFinite(roiPercent)) { return ''; }

            return `
                <div class="game-card">
                    <div class="game-header" style="display:block;">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 15px;">
                            <div class="matchup">
                                <span class="team-name">${game.away_team}</span>
                                <span class="vs">@</span>
                                <span class="team-name">${game.home_team}</span>
                            </div>
                            <div class="game-meta">
                                ${sportTag}
                            </div>
                        </div>
                        
                        <div class="arb-score high" style="width: 100%; text-align: left; padding: 15px;">
                            <div style="font-size: 16px; margin-bottom: 5px;">‚úÖ Êó†È£éÈô©Â•óÂà©Êú∫‰ºö (ROI: ${roiPercent.toFixed(2)}%)</div>
                            
                            <div class="detailed-bet-info" style="margin-top: 10px; background: rgba(0,0,0,0.2); padding: 10px; border-radius: 8px; font-size: 14px;">
                                <div style="color: #4caf50; font-weight: bold; margin-bottom: 8px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom:5px;">
                                    üí∞ ËØ¶ÁªÜ‰∏ãÊ≥®ÊñπÊ°à (ÊÄªÊäïÂÖ•: ${totalInvestment})
                                </div>
                                
                                <div style="display: flex; justify-content: space-between; margin-bottom: 4px; align-items:center;">
                                    <span>1. Âú® <b style="color: #fff;">${arb.bestAwayFrom}</b> ‰π∞ÂÖ• <b style="color: #fff;">${game.away_team}</b> (Yes)</span>
                                    <span style="background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 4px; color: #fff;">ÊäïÂÖ•: ${investAway.toFixed(2)}</span>
                                </div>
                                <div style="font-size: 12px; color: #aaa; margin-bottom: 8px; margin-left: 15px;">
                                    ‚Ü≥ ‰ª∑Ê†º: ${formatPrice(arb.bestAwayPrice)}¬¢ | È¢ÑÊúüËµî‰ªò: ${payoutAway.toFixed(2)}
                                </div>
                                
                                <div style="display: flex; justify-content: space-between; margin-bottom: 4px; align-items:center;">
                                    <span>2. Âú® <b style="color: #fff;">${arb.bestHomeFrom}</b> ‰π∞ÂÖ• <b style="color: #fff;">${game.home_team}</b> (Yes)</span>
                                    <span style="background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 4px; color: #fff;">ÊäïÂÖ•: ${investHome.toFixed(2)}</span>
                                </div>
                                 <div style="font-size: 12px; color: #aaa; margin-bottom: 8px; margin-left: 15px;">
                                    ‚Ü≥ ‰ª∑Ê†º: ${formatPrice(arb.bestHomePrice)}¬¢ | È¢ÑÊúüËµî‰ªò: ${payoutHome.toFixed(2)}
                                </div>

                                <div style="border-top: 1px solid rgba(255,255,255,0.1); margin-top: 8px; padding-top: 8px; display: flex; justify-content: space-between; font-weight: bold; font-size: 15px;">
                                    <span>È¢ÑÊúüÊÄªÂáÄÊî∂Áõä (Net Profit)</span>
                                    <span style="color: #4caf50;">+${netProfit.toFixed(2)}</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="comparison-table">
                        <!-- Away Team Row -->
                        <div class="comparison-row">
                            <div class="comparison-cell">
                                <div class="team-cell">
                                    <img src="${game.away_logo || ''}" alt="${game.away_team}" class="team-logo-cell" onerror="this.style.display='none'">
                                    <span>${game.away_team}</span>
                                </div>
                            </div>
                            <div class="comparison-cell platform-cell platform-polymarket ${awayBest === 'poly' ? 'best-odds' : ''}"
                                 onclick="window.open('${game.polymarket.url}', '_blank')">
                                <div class="platform-name">Polymarket</div>
                                <div class="odds-value">${polyAway}%</div>
                            </div>
                            <div class="comparison-cell platform-cell platform-kalshi ${awayBest === 'kalshi' ? 'best-odds' : ''}"
                                 ${game.kalshi && game.kalshi.url ? `onclick="window.open('${game.kalshi.url}', '_blank')"` : ''}>
                                <div class="platform-name">Kalshi</div>
                                <div class="odds-value">${game.kalshi ? kalshiAway + '%' : 'ÊöÇÊó†Êï∞ÊçÆ'}</div>
                                ${game.kalshi ? `<div class="diff-badge ${getDiffClass(kalshiDiffAway)}">
                                    Œî ${kalshiDiffAway.toFixed(1)}%
                                </div>` : ''}
                            </div>
                            <div class="comparison-cell platform-cell platform-odds" ${game.odds_api && game.odds_api.url ? `onclick="window.open('${game.odds_api.url}', '_blank')"` : ''}>
                                ${game.odds_api && game.odds_api.away ?
                                    `<div class="platform-name">Sportsbooks</div>
                                     <div class="odds-value">${game.odds_api.away}%</div>
                                     <div class="diff-badge low" style="font-size:10px">${game.odds_api.bookmakers.slice(0,2).join(', ')}</div>` :
                                    '<div class="unavailable">ÊöÇÊó†Êï∞ÊçÆ</div>'}
                            </div>
                            <div class="comparison-cell platform-cell platform-manifold" ${game.manifold && game.manifold.url ? `onclick="window.open('${game.manifold.url}', '_blank')"` : ''}>
                                ${game.manifold && game.manifold.away ?
                                    `<div class="platform-name">Manifold</div>
                                     <div class="odds-value">${game.manifold.away}%</div>` :
                                    '<div class="unavailable">ÊöÇÊó†Êï∞ÊçÆ</div>'}
                            </div>
                        </div>

                        <!-- Home Team Row -->
                        <div class="comparison-row">
                            <div class="comparison-cell">
                                <div class="team-cell">
                                    <img src="${game.home_logo || ''}" alt="${game.home_team}" class="team-logo-cell" onerror="this.style.display='none'">
                                    <span>${game.home_team}</span>
                                </div>
                            </div>
                            <div class="comparison-cell platform-cell platform-polymarket ${homeBest === 'poly' ? 'best-odds' : ''}"
                                 onclick="window.open('${game.polymarket.url}', '_blank')">
                                <div class="platform-name">Polymarket</div>
                                <div class="odds-value">${polyHome}%</div>
                            </div>
                            <div class="comparison-cell platform-cell platform-kalshi ${homeBest === 'kalshi' ? 'best-odds' : ''}"
                                 ${game.kalshi && game.kalshi.url ? `onclick="window.open('${game.kalshi.url}', '_blank')"` : ''}>
                                <div class="platform-name">Kalshi</div>
                                <div class="odds-value">${game.kalshi ? kalshiHome + '%' : 'ÊöÇÊó†Êï∞ÊçÆ'}</div>
                                ${game.kalshi ? `<div class="diff-badge ${getDiffClass(kalshiDiffHome)}">
                                    Œî ${kalshiDiffHome.toFixed(1)}%
                                </div>` : ''}
                            </div>
                            <div class="comparison-cell platform-cell platform-odds" ${game.odds_api && game.odds_api.url ? `onclick="window.open('${game.odds_api.url}', '_blank')"` : ''}>
                                ${game.odds_api && game.odds_api.home ?
                                    `<div class="platform-name">Sportsbooks</div>
                                     <div class="odds-value">${game.odds_api.home}%</div>
                                     <div class="diff-badge low" style="font-size:10px">${game.odds_api.bookmakers.slice(0,2).join(', ')}</div>` :
                                    '<div class="unavailable">ÊöÇÊó†Êï∞ÊçÆ</div>'}
                            </div>
                            <div class="comparison-cell platform-cell platform-manifold" ${game.manifold && game.manifold.url ? `onclick="window.open('${game.manifold.url}', '_blank')"` : ''}>
                                ${game.manifold && game.manifold.home ?
                                    `<div class="platform-name">Manifold</div>
                                     <div class="odds-value">${game.manifold.home}%</div>` :
                                    '<div class="unavailable">ÊöÇÊó†Êï∞ÊçÆ</div>'}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        
        // ÂΩìÂâçÈÄâÊã©ÁöÑ‰ΩìËÇ≤ÁßçÁ±ªÔºöÈªòËÆ§ÁªºÂêàËßÜÂõæ
        let currentSport = 'multi';

        async function fetchData() {
            try {
                // ‰ΩøÁî®Á∫∏Èù¢‰∫§ÊòìÁ≥ªÁªüÁöÑÊï∞ÊçÆÊ∫êÔºåÁ°Æ‰øùÊï∞ÊçÆ‰∏ÄËá¥ÊÄß
                let url = '/api/odds/multi';
                if (currentSport === 'nba') {
                    url = '/api/odds/nba';
                } else if (currentSport === 'nfl') {
                    url = '/api/odds/nfl';
                } else if (currentSport === 'nhl') {
                    url = '/api/odds/nhl';
                }

                const response = await fetch(url);
                const data = await response.json();

                if (!data.success) {
                    console.error('API error:', data.error);
                    return;
                }

                let allGames = [];
                let stats = {};

                if (url === '/api/odds/multi') {
                    // MULTIËßÜÂõæÔºöÂè™ÊòæÁ§∫NBA/NFL/NHL‰∏≠Êª°Ë∂≥Â•óÂà©Êù°‰ª∂ÁöÑÂ∏ÇÂú∫
                    allGames = data.homepage_arb_games || [];
                    stats = {
                        poly_total: data.stats.poly_total,
                        kalshi_total: data.stats.kalshi_total,
                        matched: data.stats.matched,
                        arb_games: allGames.length,
                        homepage_games: allGames.length
                    };
                } else {
                    // Âçï‰∏™‰ΩìËÇ≤È°πÁõÆÁöÑÊï∞ÊçÆ‰øùÊåÅÂéüÊúâÈÄªËæë
                    stats = data.stats || {};
                    
                    if (currentSport === 'nba') {
                        // NBA ËøîÂõûÁöÑÊòØ today / tomorrow ‰∏§Â§©
                        const todayGames = (data.games && data.games.today) || [];
                        const tomorrowGames = (data.games && data.games.tomorrow) || [];
                        allGames = [...todayGames, ...tomorrowGames];
                    } else {
                        // ÂÖ∂‰ªñ‰ΩìËÇ≤È°πÁõÆËøîÂõûÁöÑÊòØ‰∏Ä‰∏™ games ÂàóË°®
                        allGames = data.games || [];
                    }
                }

                const updateValue = (id, value) => {
                    const el = document.getElementById(id);
                    if (!el) return;
                    if (value === undefined || value === null || Number.isNaN(value)) {
                        el.textContent = '-';
                    } else {
                        el.textContent = typeof value === 'number' ? value : value;
                    }
                };

                // Êõ¥Êñ∞ÈÄöÁî®ÁªüËÆ°
                if (stats) {
                    updateValue('poly-count', stats.poly_total);
                    updateValue('kalshi-count', stats.kalshi_total);
                    updateValue('matched-count', stats.matched);
                }

                // Êõ¥Êñ∞NBAÁâπÂÆöÁªüËÆ°
                if (currentSport === 'nba' && data.stats) {
                    if (document.getElementById('today-count') && data.stats.today_games !== undefined) {
                        document.getElementById('today-count').textContent = data.stats.today_games;
                    }
                    if (document.getElementById('tomorrow-count') && data.stats.tomorrow_games !== undefined) {
                        document.getElementById('tomorrow-count').textContent = data.stats.tomorrow_games;
                    }
                } else {
                    // ÈùûNBAÈ°πÁõÆÊòæÁ§∫'-'
                    if (document.getElementById('today-count')) {
                        document.getElementById('today-count').textContent = '-';
                    }
                    if (document.getElementById('tomorrow-count')) {
                        document.getElementById('tomorrow-count').textContent = '-';
                    }
                }

                // ËÆ°ÁÆóÊúÄÂ§ßÊ¶ÇÁéáÂ∑Æ
                let maxDiff = 0;
                if (allGames.length > 0) {
                    maxDiff = Math.max(...allGames.map(g => (g.diff && g.diff.max) || 0));
                }
                if (document.getElementById('max-diff')) {
                    document.getElementById('max-diff').textContent = maxDiff.toFixed(1) + '%';
                }

                // ‚úÖ Âè™‰øùÁïô„ÄåÊâ£ÊéâÂèåËæπÊâãÁª≠Ë¥π+ÊªëÁÇπÂêé‰ªç‰∏∫Ê≠£„ÄçÁöÑÊó†È£éÈô©ÂáÄÂ•óÂà©
                const normalizedGames = (allGames || []).map(game => {
                    const serverArb = game.risk_free_arb || game.riskFreeArb;
                    const computedArb = serverArb || calcRiskFreeArb(game);
                    return {
                        ...game,
                        riskFreeArb: computedArb
                    };
                });

                const arbGames = normalizedGames.filter(g => g.riskFreeArb);

                console.log('üìä Êï∞ÊçÆÂ§ÑÁêÜÁªüËÆ°:');
                console.log(`  - ÊÄªÂ∏ÇÂú∫Êï∞: ${allGames.length}`);
                console.log(`  - ÊúâÂ•óÂà©Êú∫‰ºö: ${arbGames.length}`);
                console.log(`  - Ë¢´ËøáÊª§Â∏ÇÂú∫: ${allGames.length - arbGames.length}`);
                
                // ÊâìÂç∞ÂâçÂá†‰∏™Ë¢´ËøáÊª§ÁöÑÂ∏ÇÂú∫ÂèäÂéüÂõ†
                const filteredGames = normalizedGames.filter(g => !g.riskFreeArb);
                if (filteredGames.length > 0) {
                    console.log(`\nüîç Ë¢´ËøáÊª§ÁöÑÂ∏ÇÂú∫Á§∫‰æã (Ââç10‰∏™):`);
                    filteredGames.slice(0, 10).forEach((game, i) => {
                        const poly = game.polymarket || {};
                        const kalshi = game.kalshi || {};
                        const reason = !kalshi.away ? 'Áº∫Â∞ëKalshiÊï∞ÊçÆ' : 
                                      !poly.raw_away ? 'Áº∫Â∞ëPolymarket raw‰ª∑Ê†º' : 
                                      'ROI <= 0%';
                        console.log(`  ${i + 1}. ${game.away_team} @ ${game.home_team} (${game.sport}) - ${reason}`);
                        if (poly.raw_away && kalshi.away) {
                            console.log(`     Poly: away=${poly.raw_away}, home=${poly.raw_home}`);
                            console.log(`     Kalshi: away=${kalshi.raw_away || kalshi.away}, home=${kalshi.raw_home || kalshi.home}`);
                        }
                    });
                }
                
                // Êåâ‰ΩìËÇ≤Á±ªÂûãÂàÜÁªÑÁªüËÆ°
                const sportStats = {};
                allGames.forEach(g => {
                    const sport = g.sport || 'unknown';
                    if (!sportStats[sport]) sportStats[sport] = { total: 0, arb: 0 };
                    sportStats[sport].total++;
                });
                arbGames.forEach(g => {
                    const sport = g.sport || 'unknown';
                    if (sportStats[sport]) sportStats[sport].arb++;
                });
                
                console.log('\nüìà Êåâ‰ΩìËÇ≤Á±ªÂûãÁªüËÆ°:');
                Object.entries(sportStats).forEach(([sport, counts]) => {
                    console.log(`  - ${sport}: ${counts.arb}/${counts.total} ÊúâÂ•óÂà©Êú∫‰ºö`);
                });

                updateValue('arb-count', arbGames.length);
                updateValue('displayed-count', arbGames.length);

                const container = document.getElementById('games-container');

                if (!container) return;

                if (arbGames.length === 0) {
                    container.innerHTML = `
                        <div class="loading">
                            <div>ÂΩìÂâç ${currentSport.toUpperCase()} Ê≤°ÊúâËææÂà∞Êù°‰ª∂ÁöÑÂáÄÂ•óÂà©Êú∫‰ºöÔºàÂê´ÊâãÁª≠Ë¥πÂêéÔºâ</div>
                            <div style="margin-top: 10px; font-size: 14px; color: #888;">
                                ÂÖ±Ê£ÄÊü•‰∫Ü ${allGames.length} ‰∏™Â∏ÇÂú∫ÔºåËØ∑Êü•ÁúãconsoleËé∑ÂèñËØ¶ÁªÜ‰ø°ÊÅØ
                            </div>
                        </div>
                    `;
                    return;
                }

                // Ê∏≤ÊüìÂç°ÁâáÔºà‰ΩøÁî®Áé∞Êúâ createGameCardÔºâ
                container.innerHTML = arbGames.map(createGameCard).join('');

            } catch (error) {
                console.error('Error fetching data:', error);
            }
        }

        // ÁªëÂÆö sport tab ÁÇπÂáª‰∫ã‰ª∂ + ÂàùÂßãÂåñ
        window.addEventListener('DOMContentLoaded', () => {
            const tabs = document.querySelectorAll('.sport-tab');
            const investInput = document.getElementById('investment-input');

            if (investInput) {
                investInput.addEventListener('change', () => {
                    fetchData();
                });
                investInput.addEventListener('keyup', (e) => {
                    if (e.key === 'Enter') fetchData();
                });
            }

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const sport = tab.dataset.sport;
                    if (sport === currentSport) return;

                    currentSport = sport;

                    // Êõ¥Êñ∞ tab Ê†∑Âºè
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');

                    // ÈáçÊñ∞ËØ∑Ê±ÇÂΩìÂâç sport ÁöÑÊï∞ÊçÆ
                    fetchData();
                });
            });

            // ÂàùÂßãÂä†ËΩΩ
            fetchData();

            // Ëá™Âä®Âà∑Êñ∞ - 30ÁßíÈó¥Èöî‰∏éÂêéÁ´ØÁºìÂ≠ò‰∏ÄËá¥
            setInterval(fetchData, 30000);
        });
</script>
</body>
</html>