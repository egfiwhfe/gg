<!DOCTYPE html>
<html>
<head>
    <title>Test Stats Fix</title>
</head>
<body>
    <h1>Testing Stats Fix</h1>
    <div id="results"></div>
    
    <script>
        async function testStats() {
            try {
                const response = await fetch('/api/odds/all-sports');
                const data = await response.json();
                
                if (!data.success) {
                    document.getElementById('results').innerHTML = 'API Error: ' + data.error;
                    return;
                }
                
                const stats = data.stats;
                const homepageGames = data.homepage_games || [];
                
                // 模拟原来的逻辑（错误）
                const oldTotalGames = homepageGames.length;
                
                // 新的逻辑（正确）
                const newTotalGames = stats.matched_games;
                
                let html = '<h2>Statistics Comparison</h2>';
                html += '<table border="1">';
                html += '<tr><th>Metric</th><th>Old Logic</th><th>New Logic</th><th>Correct?</th></tr>';
                html += `<tr><td>比赛总数</td><td>${oldTotalGames}</td><td>${newTotalGames}</td><td>${newTotalGames === stats.matched_games ? '✓' : '✗'}</td></tr>`;
                html += `<tr><td>Polymarket总数</td><td>${stats.total_polymarket_games}</td><td>${stats.total_polymarket_games}</td><td>✓</td></tr>`;
                html += `<tr><td>Kalshi总数</td><td>${stats.total_kalshi_games}</td><td>${stats.total_kalshi_games}</td><td>✓</td></tr>`;
                html += '</table>';
                
                html += '<h2>Expected Values (according to user):</h2>';
                html += '<ul>';
                html += `<li>比赛总数 (should be matched): ${stats.matched_games}</li>`;
                html += `<li>Kalshi总数 (should be all markets): ${stats.total_kalshi_games}</li>`;
                html += '</ul>';
                
                html += '<h2>Backend Data:</h2>';
                html += '<ul>';
                html += `<li>total_polymarket_games: ${stats.total_polymarket_games}</li>`;
                html += `<li>total_kalshi_games: ${stats.total_kalshi_games}</li>`;
                html += `<li>matched_games: ${stats.matched_games}</li>`;
                html += `<li>homepage_games length: ${homepageGames.length}</li>`;
                html += '</ul>';
                
                document.getElementById('results').innerHTML = html;
                
            } catch (error) {
                document.getElementById('results').innerHTML = 'Error: ' + error.message;
            }
        }
        
        testStats();
    </script>
</body>
</html>